<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Alta de Paquete</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --b:#e5e7eb; --t:#0b2c72; --p:#0d9488; }
    body{font-family:Arial,Helvetica,sans-serif; background:#f9fafb; color:var(--t); margin:0; padding:24px;}
    .card{max-width:820px; margin:0 auto; background:#fff; border:1px solid var(--b); border-radius:10px; padding:20px 22px; box-shadow:0 4px 14px rgba(0,0,0,.06);}
    h1{font-size:20px; margin:0 0 14px 0}
    form{display:grid; gap:14px}
    .grid{display:grid; gap:12px}
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    label{font-size:13px; font-weight:600; margin-bottom:6px; display:block}
    input, textarea{width:100%; padding:10px; border:1px solid var(--b); border-radius:8px; font-size:14px}
    input:focus, textarea:focus{outline:none; border-color:var(--p); box-shadow:0 0 0 3px rgba(13,148,136,.15)}
    .hint{font-size:12px; color:#6b7280}
    .actions{display:flex; gap:10px; justify-content:flex-end; margin-top:6px}
    button{border:0; padding:10px 16px; border-radius:8px; font-weight:600; cursor:pointer}
    .primary{background:var(--p); color:#fff}
    .ghost{background:#f3f4f6}
    .readonly{background:#f9fafb}
  </style>
</head>
<body>
  <div class="card">
    <h1>Alta de paquete</h1>

    <form action="procesar_paquete.php" method="POST" id="formPaquete" novalidate>
      <div class="grid grid-2">
        <div>
          <label for="lugar">Lugar</label>
          <input type="text" id="lugar" name="lugar" required placeholder="Ej. Puerto Vallarta" />
        </div>
        <div>
          <label for="estado">Estado</label>
          <input type="text" id="estado" name="estado" required placeholder="Ej. Jalisco" />
        </div>
      </div>

      <div class="grid grid-3">
        <div>
          <label for="fecha_salida">Fecha de salida</label>
          <input type="date" id="fecha_salida" name="fecha_salida" required />
        </div>
        <div>
          <label for="fecha_llegada">Fecha de llegada</label>
          <input type="date" id="fecha_llegada" name="fecha_llegada" required />
        </div>
        <div>
          <label for="duracion">Duración (días)</label>
          <input type="number" id="duracion" name="duracion" readonly class="readonly" placeholder="Se calcula automáticamente" />
          <div class="hint">Se calcula a partir de las fechas.</div>
        </div>
      </div>

      <div class="grid grid-2">
        <div>
          <label for="costo">Costo por persona (MXN)</label>
          <input type="number" id="costo" name="costo" inputmode="decimal" step="0.01" min="0" required placeholder="Ej. 5499.00" />
        </div>
        <div>
          <label for="ultima_reserva">Última fecha para reservar</label>
          <input type="date" id="ultima_reserva" name="ultima_reserva" required />
          <div class="hint">Debe ser ≤ a la fecha de salida.</div>
        </div>
      </div>

      <div>
        <label for="incluye">Incluye</label>
        <textarea id="incluye" name="incluye" rows="4" required
          placeholder="Ej. Vuelo redondo, 2 noches de hotel, desayuno, traslados aeropuerto-hotel, tour por el centro histórico."></textarea>
      </div>

      <div class="actions">
        <button type="reset" class="ghost">Limpiar</button>
        <button type="submit" class="primary">Guardar</button>
      </div>
    </form>
  </div>

  <script>
    const salida   = document.getElementById('fecha_salida');
    const llegada  = document.getElementById('fecha_llegada');
    const reserva  = document.getElementById('ultima_reserva');
    const duracion = document.getElementById('duracion');
    const form     = document.getElementById('formPaquete');

    function daysBetween(d1, d2){
      const MS = 24*60*60*1000;
      return Math.round((d2 - d1) / MS);
    }

    function recalc() {
      const ds = new Date(salida.value);
      const dl = new Date(llegada.value);

      // Limitar reserva a no después de salida
      reserva.max = salida.value || '';

      // Validaciones de consistencia de fechas
      if (salida.value && llegada.value) {
        if (dl < ds) {
          llegada.setCustomValidity('La fecha de llegada no puede ser anterior a la salida.');
          duracion.value = '';
        } else {
          llegada.setCustomValidity('');
          const d = daysBetween(ds, dl) || 0;
          duracion.value = d;
        }
      } else {
        duracion.value = '';
        llegada.setCustomValidity('');
      }

      if (reserva.value && salida.value) {
        if (new Date(reserva.value) > ds) {
          reserva.setCustomValidity('La última fecha para reservar debe ser el mismo día o antes de la salida.');
        } else {
          reserva.setCustomValidity('');
        }
      } else {
        reserva.setCustomValidity('');
      }
    }

    salida.addEventListener('change', recalc);
    llegada.addEventListener('change', recalc);
    reserva.addEventListener('change', recalc);

    form.addEventListener('submit', (e) => {
      recalc();
      if (!form.checkValidity()) {
        e.preventDefault();
        form.reportValidity();
      }
    });
  </script>
</body>
</html>
